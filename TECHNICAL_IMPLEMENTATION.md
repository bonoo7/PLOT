# التوثيق التقني - مشروع الحبكة

## حالة المشروع الحالية (الإصدار 1.0)
تم الانتهاء من المرحلة الأولى من اللعبة (3 جولات):

### المراحل المنفذة:
1. ✅ **Lobby Phase**: إنشاء الغرف والانضمام للاعبين
2. ✅ **Role Assignment**: توزيع الأدوار (6 أدوار مختلفة)
3. ✅ **Drafting Phase**: كتابة الإجابات (90 ثانية)
4. ✅ **Presentation Phase**: عرض الإجابات
5. ✅ **Voting Phase**: التصويت (أفضل إجابة + تخمين الشاهد)
6. ✅ **Results Phase**: حساب ونشر النتائج
7. ✅ **Multi-Round System**: دعم 3 جولات متتالية مع تراكم النقاط وشاشة نهائية

### التقنيات المستخدمة:
- **Backend**: Node.js + Express + Socket.io
- **Database**: JSON File System (Low-latency, NoSQL-like structure)
- **Frontend (Web)**: HTML5 + CSS3 + JavaScript (Vanilla)
- **Frontend (Mobile)**: React Native (Expo)
- **اللغة**: JavaScript/JSX
- **الاتصال**: WebSocket (Socket.io)

## هيكلة المشروع
```
plot/
├── server/                          # Backend Node.js
│   ├── index.js                    # منطق الخادم الرئيسي
│   ├── scenarios.js                # قاعدة بيانات السيناريوهات
│   ├── database.js                 # نظام تخزين البيانات (JSON)
│   ├── db.json                     # ملف قاعدة البيانات (يتم إنشاؤه تلقائياً)
│   ├── package.json
│   └── /public                     # الملفات الثابتة
│       ├── host.html              # واجهة الشاشة الرئيسية
│       ├── player.html            # واجهة اللاعب (ويب)
│       └── style.css              # التنسيق الموحد
│
├── plot-mobile/                    # React Native (Expo)
│   ├── App.js                     # المكون الرئيسي
│   ├── app.json                   # إعدادات Expo
│   ├── package.json
│   ├── /assets
│   │   └── /roles                 # صور الشخصيات والأدوار
│   ├── /components
│   │   ├── RoleAvatar.js          # مكون عرض صورة الدور
│   │   └── BackgroundWatermark.js # خلفية الهوية البصرية
│   └── /src
│       └── /styles
│           └── theme.js           # متغيرات الألوان والتصميم
│
├── start.js                       # سكريبت التشغيل الموحد
├── package.json                   # التبعيات الرئيسية
│
└── /docs                         # التوثيق
    ├── GDD.md                    # تصميم اللعبة
    ├── TECHNICAL_IMPLEMENTATION.md
    ├── ROADMAP.md               # خطة العمل
    └── الهوية البصرية.md
```

## بروتوكول الاتصال (Socket.io Events)

### Game Initialization
- `createRoom`: Host ينشئ غرفة
- `roomCreated`: Server يرسل رمز الغرفة
- `joinRoom`: Player ينضم للغرفة
- `playerJoined`: تحديث قائمة اللاعبين
- `startGame`: Host يبدأ اللعبة

### Game Flow
- `roleAssigned`: تعيين دور وإرسال المعلومات السرية
- `gameStarted`: بدء الجولة (عرض عنوان السيناريو)
- `startDrafting`: بدء مرحلة الكتابة (مع مدة المؤقت)
- `updateDraft`: (Spy Ability) تحديث مسودة اللاعب لحظياً
- `useAbility`: طلب استخدام قدرة خاصة (Spy/Detective)
- `abilityResult`: نتيجة القدرة الخاصة
- `submitAnswer`: Player يرسل إجابته
- `timerUpdate`: تحديث العداد التنازلي
- `startTutorial`: بدء وضع التدريب (مع خيار الدور)

## الميزات المتقدمة
### وضع التدريب (Tutorial Mode)
- يسمح للاعب واحد بتجربة اللعبة.
- يتم إضافة روبوتات (Bots) تلقائياً لإكمال العدد إلى 4.
- الروبوتات تقوم بمحاكاة الكتابة والتصويت.
- يمكن للاعب اختيار الدور الذي يريده لتجربته.

### القدرات الخاصة
- **عين الصقر (Spy)**: رؤية ما يكتبه الشاهد في الوقت الفعلي (مشوش قليلاً).
- **الاستجواب (Detective)**: معرفة نسبة دقة إجابة لاعب معين ومصداقيتها.

### قاعدة البيانات (JSON)
- `db.json`: يخزن بيانات اللاعبين (النقاط، الفوز، الأدوار) وسجل المباريات.
- يتم تحديث الإحصائيات تلقائياً بعد كل لعبة.
- `startPresentation`: بدء عرض الإجابات
- `receiveAnswers`: Host يستقبل قائمة الإجابات
- `startVoting`: بدء مرحلة التصويت
- `submitVote`: Player يرسل تصويته
- `roundResults`: عرض نتائج الجولة

## الأدوار والمعلومات

| الدور | الرقم | المعلومات | الهدف |
|------|------|---------|------|
| الشاهد (WITNESS) | 1 | القصة الكاملة | كتابة إجابة صحيحة دون انكشاف |
| المهندس (ARCHITECT) | 2 | 3 كلمات مفتاحية | بناء كذبة متماسكة |
| المحقق (DETECTIVE) | 3 | عنوان السيناريو | كشف الشاهد والمهندس |
| الجاسوس (SPY) | 4 | لا شيء | محاولة نسخ القصة |
| المتواطئ (ACCOMPLICE) | 5 | اسم الشاهد | حماية الشاهد وتضليل المحقق |
| المحامي (LAWYER) | 6 | اسم الموكل | الدفاع عن الموكل ومنع اتهامه |
| المخادع (TRICKSTER) | 7 | كلمة دخيلة | إدراج الكلمة بشكل مضحك |
| المواطن (CITIZEN) | 8+ | لا شيء | البقاء محايداً |

## نظام النقاط
- **تصويت الجودة**: +1000 نقطة لكل صوت
- **الاستنتاج**: 
  - المحقق يجد الشاهد: +2500
  - لاعب عادي يجد الشاهد: +500
- **الخداع**:
  - المهندس يتفوق على الشاهد: +1500
  - الشاهد لم ينكشف: +2000
  - المتواطئ ينجح في حماية الشاهد: +1500
  - المحامي ينجح في تبرئة موكله: +1500

## ملفات التوثيق
- `GDD.md`: وثيقة تصميم اللعبة الكاملة
- `userflow.md`: تدفق المستخدم والمخططات
- `TECHNICAL_IMPLEMENTATION.md`: التوثيق التقني
- `الهوية البصرية.md`: دليل الألوان والتصميم
- `ROADMAP.md`: خطة العمل للإصدارات القادمة

## ملاحظات تقنية
- المؤقت على جانب الخادم لضمان التزامن
- الحالة تخزن في الذاكرة (In-Memory) - جاهزة للقاعدة البيانات
- Socket.io يدعم الاتصال اللحظي والموثوق
- RTL/Arabic support في جميع الواجهات


## ملفات التوثيق
- `GDD.md`: توثيق تصميم اللعبة (Game Design Document).
- `userflow.md`: تدفق المستخدم والمخططات التسلسلية.
- `الهوية البصرية.md`: دليل الألوان والعناصر البصرية.
- `README.md`: دليل الاستخدام السريع.

