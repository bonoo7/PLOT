# ๐๏ธ ูุนูุงุฑูุฉ ูุธุงู ุงูููุงุท - Scoring Architecture

**ุงูุชุงุฑูุฎ:** 14 ุฏูุณูุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ูุธุงู ููุญุฏ ููุฑูุฒู

---

## ๐ฏ ุงูููุฑุฉ ุงูุฑุฆูุณูุฉ

**ูุธุงู ุงูููุงุท ููุญุฏ ููุฑูุฒู** - ูุชู ุญุณุงุจู ูุฑุฉ ูุงุญุฏุฉ ูู ุงูุฎุงุฏู ูููุชุดุฑ ููููุจ ูุงูุฌูุงู ุชููุงุฆูุงู.

```
โโโโโโโโโโโโโโโโโโโ
โ   Server Node   โ
โ (calculate all) โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โโโโ ๐ฑ Mobile App (React Native)
         โ
         โโโโ ๐ Web Browser (HTML/JS)
```

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช

### 1. ุญุณุงุจ ุงูููุงุท (ูู ุงูุฎุงุฏู ููุท)

```javascript
// server/index.js - ุงูุณุทูุฑ 220-346
function calculateScores(room) {
    // โ ุฌููุน ุงูุฅุตูุงุญุงุช ููุฌูุฏุฉ ููุง:
    // - SPY bonus +1500
    // - TRICKSTER bonus +1500
    // - DETECTIVE penalty -500
    // - WITNESS penalty -50%
    // - LAWYER correction +2000
    // - CITIZEN correction +1000
    
    return scores;
}
```

### 2. ุฅุฑุณุงู ุงููุชุงุฆุฌ ููุฌููุน

```javascript
// server/index.js - ุงูุณุทูุฑ 348-368
function endRound(roomCode) {
    const roundScores = calculateScores(room);  // โ ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุงูููุญุณููุฉ
    
    // ุชุญุฏูุซ ุงูููุงุท ุงููููุฉ
    room.players.forEach(p => {
        p.score += (roundScores[p.id] || 0);
    });
    
    // ุฅูุดุงุก ุงููุชุงุฆุฌ
    const results = room.players.map(p => ({
        name: p.name,
        role: getRoleName(p.role),
        roundScore: roundScores[p.id] || 0,  // โ ุงูููุงุท ุงููุญุณูุจุฉ ุจุงูุฅุตูุงุญ
        totalScore: p.score
    }));
    
    // โ ุฅุฑุณุงู ููุฌููุน (ููุจ + ุฌูุงู)
    io.to(roomCode).emit('roundResults', { results });
}
```

### 3. ุงุณุชูุจุงู ุงููุชุงุฆุฌ ูู ุงูููุจ

```javascript
// server/public/host.html
socket.on('roundResults', ({ results }) => {
    // โ ุงููุชุงุฆุฌ ููุง ุชุญุชูู ุนูู ุงูููุงุท ุงููุญุณุจุฉ ุจุงูุฅุตูุงุญ
    results.forEach((p, index) => {
        // ุนุฑุถ ุงููุชุงุฆุฌ
        console.log(`${p.name}: ${p.roundScore} ููุทุฉ`);  // ูุดูู ุงูุฅุตูุงุญุงุช
    });
});
```

### 4. ุงุณุชูุจุงู ุงููุชุงุฆุฌ ูู ุงูุฌูุงู

```javascript
// plot-mobile/App.js
newSocket.on('roundResults', ({ results: resultsList }) => {
    setResults(resultsList);  // โ ุงููุชุงุฆุฌ ุชุญุชูู ุนูู ุงูุฅุตูุงุญุงุช
    setScreen('HOST_RESULTS');
});
```

---

## โ ุงูุฅุตูุงุญุงุช ุชุนูู ูู ููุง ุงููุณุฎุชูู

### ูุซุงู: ุฏูุฑ ุงูุฌุงุณูุณ

#### ูู ุงูุฎุงุฏู:
```javascript
// server/index.js (ุงูุณุทูุฑ 322-326)
const spy = room.players.find(p => p.role === 'SPY');
const spyVotes = qualityVotes[spy?.id] || 0;
if (spy && Math.abs(spyVotes - witnessVotes) <= 1 && spyVotes > 0) {
    scores[spy.id] += 1500;  // โ ุงูููุงูุฃุฉ ุชูุญุณุจ ููุง
}
```

#### ูู ุงูููุจ:
```javascript
// server/public/host.html
socket.on('roundResults', ({ results }) => {
    results.forEach(p => {
        if (p.role === 'ุงูุฌุงุณูุณ') {
            console.log(`ููุงุท ุงูุฌุงุณูุณ: ${p.roundScore}`);
            // โ ูุดูู +1500 ุงูููุงูุฃุฉ ูู ุงูุฎุงุฏู
        }
    });
});
```

#### ูู ุงูุฌูุงู:
```javascript
// plot-mobile/App.js
newSocket.on('roundResults', ({ results: resultsList }) => {
    const spyResults = resultsList.find(p => p.role === 'ุงูุฌุงุณูุณ');
    console.log(`ููุงุท ุงูุฌุงุณูุณ: ${spyResults?.roundScore}`);
    // โ ูุดูู +1500 ุงูููุงูุฃุฉ ูู ุงูุฎุงุฏู
});
```

---

## ๐ ููุงุฐุง ูุฐุง ุงูุชุตููู ุฃูุถูุ

### ุงููููุฒุงุช:

1. **โ ููุญุฏ:** ููุทุฉ ูุงุญุฏุฉ ูู ุงูุญูููุฉ (Single Source of Truth)
   - ูุง ุชูุฌุฏ ุญุณุงุจุงุช ูุฎุชููุฉ ูู ุงูููุจ ูุงูุฌูุงู
   - ุฌููุน ุงูููุงููุชุงุช ุชุฑู ููุณ ุงูููุงุท

2. **โ ุขูู:** 
   - ุงูุฎุงุฏู ูุชุญูู ุจุญุณุงุจ ุงูููุงุท
   - ุงููุงุนุจูู ูุง ูุณุชุทูุนูู ุงูุบุด ุจุชุนุฏูู ุงูููุงุท ูุญููุงู

3. **โ ุณูู ุงูุตูุงูุฉ:**
   - ุฅุตูุงุญ ูุงุญุฏ = ูุคุซุฑ ุนูู ุงูุฌููุน ุชููุงุฆูุงู
   - ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ุงูููุจ ูุงูุฌูุงู ุจุดูู ูููุตู

4. **โ ูุงุจู ููุชูุณุน:**
   - ูููู ุฅุถุงูุฉ ููุตุงุช ุฌุฏูุฏุฉ ุจุณูููุฉ
   - ูููู ูุณุชูุจููู ููุณ ุงูุจูุงูุงุช

---

## ๐ ููุฎุต ุงููููุงุช

### ููู ุงูุญุณุงุจ (Server):
```
๐ server/
โโ index.js
   โโ calculateScores() โ โ ุฌููุน ุงูุฅุตูุงุญุงุช ููุง
   โโ endRound() โ ุชุฑุณู ุงููุชุงุฆุฌ
```

### ูููุงุช ุงูููุจ (Web):
```
๐ server/public/
โโ host.html
โ  โโ socket.on('roundResults') โ ุงุณุชูุจุงู ุงููุชุงุฆุฌ
โโ player.html
   โโ socket.on('roundResults') โ ุงุณุชูุจุงู ุงููุชุงุฆุฌ
```

### ูููุงุช ุงูุฌูุงู (Mobile):
```
๐ plot-mobile/
โโ App.js
   โโ socket.on('roundResults') โ ุงุณุชูุจุงู ุงููุชุงุฆุฌ
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ููุชุญูู ูู ุฃู ุงูุฅุตูุงุญุงุช ุชุนูู ูู ููุง ุงููุณุฎุชูู:

#### ุงูุฎุทูุฉ 1: ุงุจุฏุฃ ูุนุจุฉ ูุงููุฉ
```bash
npm start
```

#### ุงูุฎุทูุฉ 2: ุงูุชุญ ููุง ุงููุงุฌูุงุช
- ๐ ุงูููุจ: `http://localhost:3000/host.html`
- ๐ฑ ุงูุฌูุงู: Expo ุนูู `http://192.168.8.19:3000`

#### ุงูุฎุทูุฉ 3: ูุงุญุธ ุงูููุงุท

**ุณููุงุฑูู:** ุฌุงุณูุณ ูุงุฌุญ
- ุงูุดุงูุฏ: 3 ุฃุตูุงุช โ +3000
- ุงูุฌุงุณูุณ: 2 ุฃุตูุงุช โ +2000 + **1500 ููุงูุฃุฉ** = 3500

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูููุจ: ูุธูุฑ 3500
- โ ุงูุฌูุงู: ูุธูุฑ 3500
- โ ููุงููุง ูุชุทุงุจู โ

---

## ๐ ุขููุฉ ุงูุงุชุตุงู

```
WebSocket (Socket.io)
โ
Server
โโ emit 'roundResults' โ Web
โโ emit 'roundResults' โ Mobile
```

**ุงูุจูุงูุงุช ุงูููุฑุณูุฉ:**
```javascript
{
    results: [
        {
            name: "ุงููุงุนุจ 1",
            role: "ุงูุฌุงุณูุณ",
            roundScore: 3500,     // โ ูุดูู ุงูุฅุตูุงุญุงุช
            totalScore: 3500
        },
        // ... ุจุงูู ุงููุงุนุจูู
    ]
}
```

---

## ๐ก ููู ุชุนูู ุงูุฅุตูุงุญุงุช ูุน ูู ููุตุฉุ

### ุงูุฅุตูุงุญ 1: ุงูุฌุงุณูุณ +1500

```
โ ุจุฏูู ุฅุตูุงุญ:
   ุงูุฌุงุณูุณ: 2000 (ูู ุงูุฃุตูุงุช ููุท)

โ ูุน ุงูุฅุตูุงุญ:
   ูู ุงูุฎุงุฏู: scores[spy.id] += 1500
   โ
   ุงูููุจ ูุณุชูุจู: 3500 โ
   ุงูุฌูุงู ูุณุชูุจู: 3500 โ
```

### ุงูุฅุตูุงุญ 2: ุงููุฎุงุฏุน +1500

```
โ ุจุฏูู ุฅุตูุงุญ:
   ุงููุฎุงุฏุน: 1000 (ูู ุงูุฃุตูุงุช ููุท)

โ ูุน ุงูุฅุตูุงุญ:
   ูู ุงูุฎุงุฏู: scores[trickster.id] += 1500
   โ
   ุงูููุจ ูุณุชูุจู: 2500 โ
   ุงูุฌูุงู ูุณุชูุจู: 2500 โ
```

### ุงูุฅุตูุงุญ 3: ุงููุญูู -500

```
โ ุจุฏูู ุฅุตูุงุญ:
   ุงููุญูู: 0 (ูุง ุงุตูุงุชุ ูุง ุนููุจุฉ)

โ ูุน ุงูุฅุตูุงุญ:
   ูู ุงูุฎุงุฏู: scores[detective.id] -= 500
   โ
   ุงูููุจ ูุณุชูุจู: -500 โ
   ุงูุฌูุงู ูุณุชูุจู: -500 โ
```

### ูููุฐุง ูุฌููุน ุงูุฅุตูุงุญุงุช...

---

## ๐ฏ ุงููุชูุฌุฉ

**โ ุฌููุน ุงูุฅุตูุงุญุงุช ุชุนูู ุจููุณ ุงูุทุฑููุฉ ูู ุงูููุจ ูุงูุฌูุงู ูุฃููุง:**

1. ุชูุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ูู ุงูุฎุงุฏู
2. ุชูุฑุณู ููููุจ ูุงูุฌูุงู ุนุจุฑ WebSocket
3. ุชูุนุฑุถ ูุจุงุดุฑุฉ ุจุฏูู ูุนุงูุฌุฉ ุฅุถุงููุฉ

**ูุง ุญุงุฌุฉ ูู:**
- โ ุชุญุฏูุซ ูููุตู ููููุจ
- โ ุชุญุฏูุซ ูููุตู ููุฌูุงู
- โ ุญุณุงุจุงุช ูุชุนุฏุฏุฉ

**ูู ุดูุก ููุญุฏ ููุฑูุฒู ูู ุงูุฎุงุฏู!**

---

## ๐ ุฌุฏูู ุงูููุตุงุช

| ุงูููุตุฉ | ุงูุญุณุงุจ | ุงูุงุณุชูุจุงู | ุงูุนุฑุถ |
|------|--------|---------|-------|
| **Server** | โ ููุง (calculateScores) | - | - |
| **Web** | - | โ (socket.on) | โ |
| **Mobile** | - | โ (socket.on) | โ |

---

**ุงูุฎูุงุตุฉ: ุฌููุน ุงูุฅุตูุงุญุงุช ุชุธูุฑ ุชููุงุฆูุงู ูู ููุง ุงููุณุฎุชูู! โ**

